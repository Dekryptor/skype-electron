"use strict";
const path = require('path');
const os = require('os');
const account_exporter_1 = require('./account-exporter');
const batch_html_exporter_1 = require('./batch-html-exporter');
const fileUtils = require('./file-utils');
function fetchDefaultDbAccountsAsync() {
    const dbName = 'main.db';
    const defaultLocations = findDbFolders(dbName).map((folder) => {
        return path.join(folder, dbName);
    });
    const exporter = new account_exporter_1.AccountExporter(defaultLocations);
    return exporter.getAccountDetails();
}
exports.fetchDefaultDbAccountsAsync = fetchDefaultDbAccountsAsync;
function exportAccountsAsync(accounts, outputDir, progressReporter) {
    const batchExorter = new batch_html_exporter_1.BatchHtmlExporter(accounts, outputDir);
    if (progressReporter) {
        batchExorter.onProgress(progressReporter);
    }
    return batchExorter.export();
}
exports.exportAccountsAsync = exportAccountsAsync;
function findDbFolders(fileName, root) {
    if (!fileName) {
        throw Error('DB file name missing');
    }
    if (!root) {
        root = '.';
        if (fileUtils.isWindows()) {
            root = path.join(os.homedir(), 'AppData', 'Roaming', 'Skype');
        }
        else if (fileUtils.isMac()) {
            root = path.join(os.homedir(), 'Library', 'Application Support', 'Skype');
        }
        else if (fileUtils.isLinux()) {
            root = path.join(os.homedir(), '.Skype');
        }
    }
    const folders = fileUtils.findFile(root, fileName, 4);
    return folders;
}
exports.findDbFolders = findDbFolders;
