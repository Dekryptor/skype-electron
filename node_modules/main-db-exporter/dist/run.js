"use strict";
const process = require('process');
const os = require('os');
const path = require('path');
const exporter = require('./index');
process.on('uncaughtException', function (err) {
    console.log(`Error: ${err.message}\n${err.stack}`);
});
let outputFolderLocation = getArg('--out');
if (!outputFolderLocation) {
    outputFolderLocation = getDefaultOutputFolder();
}
exporter.fetchDefaultDbAccountsAsync().then((accounts) => {
    console.log(`Found profiles: ${JSON.stringify(accounts)}`);
    exporter.exportAccountsAsync(accounts, outputFolderLocation, (progress) => { console.log(`Exporting: ${progress}%`); })
        .then(() => { console.log(`All exported to ${outputFolderLocation}`); })
        .catch((err) => { console.log(`Error: ${err.message}`); });
});
function getArg(argument) {
    const argLen = process.argv.length;
    const ind = process.argv.indexOf(argument);
    let value = null;
    if (ind > -1 && (ind + 1) < argLen) {
        value = process.argv[ind + 1];
    }
    return value;
}
function getDefaultOutputFolder() {
    return path.join(os.homedir(), 'skype-export');
}
